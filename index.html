<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Typing Wizard â€“ Mobile Wrapper</title>
  <style>
    html,body {margin:0;height:100%;background:#0e0f19;display:flex;flex-direction:column;}
    #topbar {background:#16182a;padding:10px;display:flex;gap:10px;justify-content:center;border-bottom:1px solid #22253e;}
    #topbar button {
      background:#7ea1ff; border:none; border-radius:8px;
      padding:8px 12px; font-weight:700; cursor:pointer; color:#0b0d18;
    }
    #game {flex:1; border:0; width:100%;}
    #kb { position:fixed; left:-10000px; top:-10000px; opacity:0; }
  </style>
</head>
<body>
  <div id="topbar">
    <button id="mobileStartBtn">Start for Mobile</button>
  </div>
  <iframe id="game" src="game.html" allow="gamepad *"></iframe>
  <input id="kb" type="text" autocapitalize="none" autocomplete="off" autocorrect="off" spellcheck="false">

  <script>
    const frame = document.getElementById('game');
    const kb = document.getElementById('kb');
    const mobileStartBtn = document.getElementById('mobileStartBtn');

    function focusKeyboard() {
      kb.value = '';
      kb.focus({ preventScroll:true });
      // small keep-alive refocus to resist focus steals
      setTimeout(() => {
        if (document.activeElement !== kb) kb.focus({ preventScroll:true });
      }, 50);
    }

    // Forward keys from hidden input to the game (which listens on window keydown)
    kb.addEventListener('input', () => {
      const val = kb.value;
      if (!val) return;
      const ch = val.slice(-1);
      kb.value = '';
      if (!/^[a-zA-Z]$/.test(ch)) return;
      frame.contentWindow.dispatchEvent(new KeyboardEvent('keydown', { key: ch, bubbles: true }));
    });

    kb.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace') {
        frame.contentWindow.dispatchEvent(new KeyboardEvent('keydown', { key:'Backspace', bubbles:true }));
        e.preventDefault();
      }
    });

    // Keep keyboard open during taps
    window.addEventListener('touchend', () => {
      if (document.activeElement !== kb) kb.focus({ preventScroll:true });
    });

    // Mobile Start button: open keyboard + start the game in iframe
    mobileStartBtn.addEventListener('click', () => {
      focusKeyboard();
      frame.contentWindow.postMessage({ type:'TW_START_GAME' }, '*');
    });
  </script>
</body>
</html>
