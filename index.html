<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Typing Wizard â€“ Mobile Wrapper</title>
  <style>
    html,body {margin:0;height:100%;background:#0e0f19;}
    #game {position:fixed; inset:0; border:0; width:100%; height:100%;}
    /* hidden input to trigger mobile keyboard */
    #kb { position:fixed; left:-10000px; top:-10000px; opacity:0; }
    /* overlay button to capture the real user tap */
    #mobileStartOverlay {
      position:fixed; inset:0; z-index:9999;
      background:transparent; border:none;
      display:none;
    }
  </style>
</head>
<body>
  <iframe id="game" src="game.html" allow="gamepad *"></iframe>
  <input id="kb" type="text" autocapitalize="none" autocomplete="off" autocorrect="off" spellcheck="false">
  <button id="mobileStartOverlay"></button>

  <script>
    const frame = document.getElementById('game');
    const kb = document.getElementById('kb');
    const bridgeBtn = document.getElementById('mobileStartOverlay');

    function focusKeyboard() {
      kb.value = '';
      kb.focus({ preventScroll: true });
      // re-focus shortly after to keep keyboard up
      setTimeout(() => {
        if (document.activeElement !== kb) kb.focus({ preventScroll: true });
      }, 50);
    }

    // Forward typed chars/backspace to the game
    kb.addEventListener('input', () => {
      const val = kb.value;
      if (!val) return;
      const ch = val.slice(-1);
      kb.value = '';
      if (!/^[a-zA-Z]$/.test(ch)) return;
      frame.contentWindow.dispatchEvent(new KeyboardEvent('keydown', { key: ch, bubbles: true }));
    });

    kb.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace') {
        frame.contentWindow.dispatchEvent(new KeyboardEvent('keydown', { key: 'Backspace', bubbles: true }));
        e.preventDefault();
      }
    });

    // Keep focus so keyboard stays open
    window.addEventListener('touchend', () => {
      if (document.activeElement !== kb) kb.focus({ preventScroll: true });
    });

    // Listen for requests from game
    window.addEventListener('message', (e) => {
      if (!e || !e.data) return;
      if (e.data.type === 'TW_REQUEST_MOBILE_START') {
        // Show invisible overlay button to capture next tap
        bridgeBtn.style.display = 'block';
      }
    });

    // When overlay tapped: focus keyboard + start game
    bridgeBtn.addEventListener('click', () => {
      focusKeyboard();
      frame.contentWindow.postMessage({ type: 'TW_START_GAME' }, '*');
      bridgeBtn.style.display = 'none';
    });
  </script>
</body>
</html>
