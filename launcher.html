<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Typing Wizard â€“ Launcher</title>
  <style>
    html,body { margin:0; height:100%; background:#0e0f19; }
    #gameframe { position:fixed; inset:0; width:100%; height:100%; border:0; }
    #kbBtn {
      position:fixed; top:10px; right:10px; z-index:9999;
      display:none;
      background:#7ea1ff; color:#0b0d18; font-weight:700;
      border:none; border-radius:10px; padding:8px 12px; cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }
    #kbBtn:active { transform:translateY(1px); }
    #kbInput { position:fixed; left:-10000px; top:-10000px; opacity:0; }
  </style>
</head>
<body>
  <iframe id="gameframe" src="index.html" allow="gamepad *"></iframe>
  <button id="kbBtn" aria-label="Open keyboard">Keyboard</button>
  <input id="kbInput" type="text" autocapitalize="none" autocomplete="off" autocorrect="off" spellcheck="false" />

  <script>
    const isTouch = (('maxTouchPoints' in navigator && navigator.maxTouchPoints > 0)
                  || window.matchMedia('(pointer: coarse)').matches
                  || 'ontouchstart' in window);

    const frame = document.getElementById('gameframe');
    const kbBtn = document.getElementById('kbBtn');
    const kb = document.getElementById('kbInput');

    if (isTouch) kbBtn.style.display = 'inline-block';

    function focusKeyboard() {
      kb.value = '';
      kb.focus({ preventScroll: true });
      setTimeout(() => { if (document.activeElement !== kb) kb.focus({ preventScroll:true }); }, 50);
    }

    kbBtn.addEventListener('click', () => {
      focusKeyboard();
    });

    kb.addEventListener('input', () => {
      const val = kb.value;
      if (!val) return;
      const ch = val.slice(-1);
      kb.value = '';
      if (!/^[a-zA-Z]$/.test(ch)) return;
      frame.contentWindow.dispatchEvent(new KeyboardEvent('keydown', { key: ch, bubbles: true }));
    });
    kb.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace') {
        frame.contentWindow.dispatchEvent(new KeyboardEvent('keydown', { key:'Backspace', bubbles:true }));
        e.preventDefault();
      }
    });
    window.addEventListener('touchend', () => {
      if (document.activeElement !== kb) kb.focus({ preventScroll:true });
    });
  </script>
</body>
</html>
